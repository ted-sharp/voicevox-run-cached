# VoicevoxRunCached リリースノート

## 🎉 v1.3.0 - 2025年7月24日

### ✨ 新機能

#### 🎯 インテリジェントフィラー機能
- **自然な間つなぎ音声**: 音声生成待機中に「えーっと、」「あのー、」などの自然なフィラー音声を自動再生
- **セグメント別対応**: 未生成セグメントがある場合のみフィラーを差し込み、効率的な処理
- **読点付き語調**: 語尾が自然に下がる読点（、）付きフィラーで話の始めに適した音調
- **6種類のフィラー**: 「えーっと、」「あのー、」「あのう、」「ええと、」「ええっと、」「えとえと、」からランダム選択
- **専用キャッシュ**: フィラー音声の事前生成とMP3キャッシュでスムーズな再生

#### 🔧 エンジン自動起動・管理機能
- **自動検出・起動**: VOICEVOXエンジンの自動検出と起動（設定可能）
- **複数エンジン対応**: VOICEVOX と AIVIS Speech の両方をサポート
- **プロセス管理**: エンジンの起動状態管理とプロセス永続化オプション
- **タイムアウト保護**: エンジン起動の安全なタイムアウト処理

#### 📊 詳細実行時間測定
- **--verbose オプション**: 各処理ステップの詳細な実行時間を表示
- **パフォーマンス分析**: エンジンチェック、セグメント処理、音声再生時間の内訳
- **最適化支援**: ボトルネック特定のための詳細タイミング情報

### 🚀 パフォーマンス改善

#### ⚡ DNS解決最適化
- **127.0.0.1使用**: `localhost` から `127.0.0.1` への変更でDNS解決遅延を解消
- **大幅な高速化**: エンジンチェック時間が2000ms → 40ms程度に短縮

#### 🔄 エンジン再利用
- **KeepEngineRunning**: アプリ終了後もエンジンを起動したまま維持（デフォルト有効）
- **2回目以降の高速化**: エンジン起動済みの場合の即座実行

### 🛠️ 技術改善

#### 🔒 安全性向上
- **無限ループ対策**: フィラー機能での複数の安全機構実装
- **タイムアウト保護**: 各処理での適切なタイムアウト設定
- **エラーハンドリング**: 堅牢な例外処理とフォールバック機能

#### 🎵 音声品質改善
- **リソース競合回避**: フィラー用別AudioPlayerインスタンスで音声品質向上
- **デッドロック対策**: 適切なリソース管理による安定性向上

### ⚙️ 設定機能拡張

#### 新しい設定項目
- **VoiceVox設定**:
  - `AutoStartEngine`: エンジン自動起動の有効/無効
  - `EnginePath`: エンジン実行ファイルパス（自動検出対応）
  - `EngineArguments`: エンジン起動引数
  - `StartupTimeoutSeconds`: 起動タイムアウト時間
  - `EngineType`: エンジンタイプ（VOICEVOX/AivisSpeech）
  - `KeepEngineRunning`: エンジン永続化設定

- **Filler設定**:
  - `Enabled`: フィラー機能の有効/無効
  - `Directory`: フィラーキャッシュディレクトリ
  - `FillerTexts`: カスタマイズ可能なフィラーテキスト配列

### 🔨 破壊的変更

#### 設定ファイル更新
- **BaseURL変更**: `http://localhost:50021` → `http://127.0.0.1:50021`
- **新設定項目追加**: フィラー関連設定とエンジン管理設定の追加

### 📝 コマンドライン拡張

#### 新しいオプション・コマンド
- `--verbose`: 詳細実行時間表示
- `--init`: フィラーキャッシュ初期化

### 🐛 バグ修正
- null参照警告の解消（AudioPlayer内のnullチェック強化）
- ANSI エスケープシーケンスの修正（Windowsコンソール対応）
- プロセス終了時のリソース競合問題の解決
- フィラー再生時の無限ループ問題の解決

### 📚 ドキュメント更新
- README.mdの大幅更新（新機能説明、設定例、パフォーマンス分析）
- 設定項目の詳細説明追加
- フィラー機能の専用セクション追加
- トラブルシューティング情報の更新

---

## 📋 v1.2.0 - 2025年7月中旬

### ✨ 主な機能
- **基本的な音声合成**: VOICEVOX REST APIを使用したテキスト音声変換
- **MP3キャッシュシステム**: 生成した音声のMP3形式でのキャッシュ
- **セグメント化処理**: 文単位での分割によるキャッシュ効率向上
- **即時再生**: キャッシュヒット済みセグメントの即座再生開始
- **安定した音声再生**: NAudioを使用した高品質な音声再生
- **デバイス準備機能**: オーディオデバイスの暖気運転で音切れ防止

### ⚙️ 設定機能
- **カスタマイズ可能なパラメータ**: 音声速度、ピッチ、音量の調整
- **キャッシュ管理**: 有効期限とサイズ制限の設定
- **オーディオデバイス選択**: 出力デバイスの指定

### 🔧 コマンドライン
- **基本的なオプション**: --speaker, --speed, --pitch, --volume
- **キャッシュ制御**: --no-cache, --cache-only
- **スピーカー一覧**: speakers コマンド

## 📋 v1.1.0 - 2025年7月初旬

### 🎵 音声品質改善
- **デバイス準備機能の強化**: 初回再生時の音声品質安定化
- **極小音量での暖気運転**: USBオーディオ・Bluetooth対応

### 🔧 設定拡張
- **Audio設定の追加**:
  - `PrepareDevice`: デバイス準備機能
  - `PreparationDurationMs`: 準備時間設定
  - `PreparationVolume`: 準備時音量設定

### 🐛 バグ修正
- 初回音声再生時の音切れ問題の解決
- USBオーディオデバイスでの安定性向上

## 📋 v1.0.0 - 2025年6月

### 🎉 初回リリース
- **基本的な音声合成機能**: VOICEVOXを使用したテキスト音声変換
- **シンプルなキャッシュシステム**: WAV形式での基本キャッシュ
- **コマンドライン実行**: 基本的なCLI操作
- **Windows対応**: Windows環境での動作確認

---

## 🚀 アップグレードガイド

### v1.2.0 からのアップグレード

1. **設定ファイル更新**:
   ```json
   {
     "VoiceVox": {
       "BaseUrl": "http://127.0.0.1:50021",  // localhost から変更
       "AutoStartEngine": true,               // 新規追加
       "KeepEngineRunning": true             // 新規追加
     },
     "Filler": {                             // 新規セクション
       "Enabled": true,
       "Directory": "./cache/filler/"
     }
   }
   ```

2. **フィラー初期化**:
   ```bash
   VoicevoxRunCached.exe --init
   ```

3. **新機能の確認**:
   ```bash
   VoicevoxRunCached.exe "テスト" --verbose
   ```

### 既知の制限事項
- フィラー機能はWindows環境でのテスト完了
- エンジン自動起動はWindows標準インストールパスに対応
- AIVIS Speechサポートは基本機能のみ

---

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>